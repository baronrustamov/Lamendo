<!DOCTYPE html>
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
        <title>{{board_acronym}}</title>
        <link href="{{ url_for('static', filename='css/index.css') }}" rel="stylesheet">
        <link rel="shortcut icon" type="image/png" href="https://www.freefavicon.com/freefavicons/software/cup-of-coffee-152-78475.png"/>
    </head>
    <body>
        
        <h1><a href="{{url_for('home')}}">Boards</a></h1>
        <h2 class="title">{{board_acronym}}</h2>
        <div class="postform">
            <h3>Create Post</h3>
            <form method="POST" action="/{{board_acronym}}/post" enctype="multipart/form-data">
                <div class="postform">
                    <textarea class="post_textarea" maxlength="500" type="text" name="post_upload_text" rows="4" cols="40"></textarea>
                </div>
                <div class="postform">
                    <input  type="file" value="Choose File" name="post_upload_image">
                </div>
                <input type="submit" value="Post">
            </form>
        </div>
        <div>
            {% if posts %}
                <h3>Posts</h3>
                {% for post_and_reply in posts %}
                <ul>
                    <!-- Posts -->
                    <div class="metadata">
                        {{ post_and_reply.post.date + " " + post_and_reply.post.user }}
                        {% if post_and_reply.post.image_filename %}
                            {{post_and_reply.post.image_filename}}
                        {% endif %}
                    </div>
                    <div class="metadata">
                        <button class="replybutton" data-reply_action="/{{board_acronym}}/{{post_and_reply.post.post_id}}/reply">reply</button>
                    </div>
                    <div class="img_and_caption">
                        {% if post_and_reply.post.image_filename %}
                            <a href="{{url_for('static', filename='img_uploads/' + post_and_reply.post.image_uniqid + post_and_reply.post.image_ext)}}">
                                <img src="{{url_for('static', filename='img_uploads/' + post_and_reply.post.image_uniqid + post_and_reply.post.image_ext)}}"/>
                            </a>
                        {% endif %}
                        {% if post_and_reply.post.post %}
                            {{ post_and_reply.post.post }}
                        {% endif %}
                    </div>

                    <!-- Replies -->
                    {% if post_and_reply.reply %}
                        <div class="replies">
                            {% for reply in post_and_reply.reply %}
                                <div class="metadata">
                                    {{ reply.date + " " + reply.user }}
                                    {% if reply.image_filename %}
                                        {{reply.image_filename}}
                                    {% endif %}
                                </div>
                                <div class="img_and_caption">
                                    {% if reply.image_filename %}
                                        <a href="{{url_for('static', filename='img_uploads/' + reply.image_uniqid + reply.image_ext)}}">
                                            <img src="{{url_for('static', filename='img_uploads/' + reply.image_uniqid + reply.image_ext)}}"/>
                                        </a>
                                    {% endif %}
                                    {{ reply.reply }}
                                    </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </ul>
                {% endfor %}
            {% endif %}
        </div>
        
        <div class="replymodal">
            <div id="replybuttonclose" class="close">&times;</div>
            <h3>Reply</h3>
            <form id="reply_form_id_for_action" action="" method="POST" enctype="multipart/form-data">
                <div class="replyform">
                    <textarea class="reply_textarea" maxlength="500" type="text" name="reply_upload_text" rows="4" cols="48" placeholder="Reply"></textarea>
                </div>
                <div class="replyform">
                    <input  type="file" value="Choose File" name="reply_upload_image">
                </div>
                <input type="submit" value="Reply">
            </form>
        </div>

        <script>
            $('.replybutton').click(function() {
                $('.replymodal').show();
                // For telling the form which post this reply is from:
                // assign the action attibute where id=reply_form_id_for_action
                // to the specific reply button's data-reply_form_action attribute
                $('#reply_form_id_for_action').attr("action", $(this).attr("data-reply_action"));
                $('.replymodal').draggable({ containment: "html", scroll: false });
            });
            $('#replybuttonclose').click(function() {
                $('.replymodal').hide();
            });
        </script>
    </body>
</html>